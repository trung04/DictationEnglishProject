package com.project.englishweb.Controller.API;

import com.project.englishweb.DTO.ChangeEmailRequest;
import com.project.englishweb.DTO.ChangePasswordRequest;
import com.project.englishweb.DTO.UserAccountDTO;
import com.project.englishweb.DTO.UserPublicProfileDTO;
import com.project.englishweb.Service.UserApiService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/api/user")
@CrossOrigin(origins = "http://localhost:3000")
public class UserApiController {

    private final UserApiService userApiService;

    @Autowired
    public UserApiController(UserApiService userApiService) {
        this.userApiService = userApiService;
    }

    @GetMapping("/profile/{username}")
    public UserPublicProfileDTO getPublicProfile(@PathVariable String username) {
        return userApiService.getPublicProfile(username);
    }

    @GetMapping("/account")
    public UserAccountDTO getAccountInfo(@RequestHeader("Authorization") String token) {
        return userApiService.getAccountInfo(token);
    }

    @PostMapping("/change-password")
    public String changePassword(@RequestHeader("Authorization") String token,
                                  @RequestBody ChangePasswordRequest request) {
        userApiService.changePassword(token, request);
        return "Đổi mật khẩu thành công!";
    }

    @PostMapping("/change-email")
    public String changeEmail(@RequestHeader("Authorization") String token,
                               @RequestBody ChangeEmailRequest request) {
        userApiService.changeEmail(token, request);
        return "Đổi email thành công!";
    }
}
